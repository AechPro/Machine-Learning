#:kivy 1.0.9
#:import kivy kivy
#:import win kivy.core.window
#:import Histogram Util.Camera_Histogram
#:import Camera_Canvas Util.D3_Camera_Image_Canvas
<D3Button@Button>:
    size_hint: .3, .2
    color: 0, 0, 0, 1
    font_size: 32
    bold: True
    background_color: 1, 1, 1, 1
    halign: "center"

<Display_Object@Screen>:
    FloatLayout:
        background_color: 0, 0.5, 0.5, 1

<D3TextInput@TextInput>:
    size_hint: .2, None
    height: 35
    color: 0, 0, 0, 1
    font_size: 20
    background_color: 1, 1, 1, 1

<D3Label@Label>:
    size_hint: .2, None
    height: 45
    color: 1, 1, 1, 1
    font_size: 20
    background_color: 1, 1, 1, 1
    text_size: self.size
    halign: 'left'
    valign: 'middle'

<D3Image@Image>:
    allow_stretch:True
    size: 400, 400


<Login_Screen@Display_Object>:
    Label:
        font_size: 140
        bold: True
        text: "D3"
        pos_hint: {'x':0.0,'y':0.2}

    D3TextInput:
        id: username
        pos_hint: {'x':0.23, 'y':0.4}
        hint_text: "User ID"
        multiline: False

    D3TextInput:
        id: password
        pos_hint: {'x':0.23, 'y':0.3}
        hint_text: "Password"
        password: True
        multiline: False

    D3Button:
        text: "LOGIN"
        pos_hint: {'x': 0.6, 'y':0.3}
        size_hint: 0.15, 0.15
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'

<Clean_CCD_Screen@Display_Object>:
    Label:
        text: "CLEAN CCD"
        color: 1,0,0,1
        pos_hint:{'center_x':0.5,'center_y':0.5}
        font_size: 64
    D3Button:
        text: "OK"
        pos_hint: {'center_x': 0.5, 'y':0.1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'

<Change_Patient_Screen@Display_Object>:
    Label:
        font_size: 140
        bold: True
        text: "D3"
    D3Button:
        text: "New Patient"
        pos_hint: {'x': 0.1, 'y':0.1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'right'

    D3Button:
        text: "Browse Patients"
        pos_hint: {'x':0.6, 'y':0.1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'


<Create_New_Patient_Screen@Display_Object>:

    D3Button:
        text: "Cancel"
        pos_hint: {'x': 0.1, 'y':0.1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'

    D3Button:
        text: "Save Patient"
        pos_hint: {'x':0.6, 'y':0.1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'

    D3Label:
        text: "Patient Name"
        pos_hint: {'x':0.1, 'y':0.8}

    D3TextInput:
        id: patient_name
        pos_hint: {'x':0.4, 'y':0.8}
        text: ""
        multiline: False

    D3Label:
        text: "Comments"
        pos_hint: {'x':0.1, 'y':0.6}

    D3TextInput:
        id: patient_comments
        pos_hint: {'x':0.4, 'y':0.6}
        text:""
        height:80

<Browse_Patients_Screen@Display_Object>:
    FileChooserListView:
        id: filechooser
        path: "data/patients/"

    D3Button:
        text: "Cancel"
        pos_hint: {'x': 0.1, 'y':0.1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'right'

    D3Button:
        text: "Select"
        pos_hint: {'x': 0.6, 'y':0.1}
        on_press:
            root.button_press(self.text, data=filechooser.selection)
            root.manager.transition.direction = 'left'

<Sample_View_Screen@Display_Object>:
    D3Image:
        id: sample_image
        source:

    D3Button:
        text: "Retry"
        pos_hint: {'x': 0.1, 'y':0.1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'right'

    D3Button:
        text: "Save"
        pos_hint: {'x': 0.6, 'y':0.1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'

<Idle_Screen@Display_Object>:
    StackLayout:
        orientation: 'tb-rl'
        pos_hint:{"x":-0.005,"y":-0.1}
        spacing: [0,5]
        D3Button:
            size_hint: .2, .15
            text: "Toggle\nLED"
            on_press:
                root.button_press(self.text)
                root.manager.transition.direction = 'left'
        BoxLayout:
            orientation: 'horizontal'
            size_hint: .2,.1
            canvas.before:
                Color:
                    rgba: 1, 1, 1, .1
                Rectangle:
                    pos: (self.pos[0] + self.width - self.size[0]/3 - 2,self.pos[1]+1)
                    size: (self.size[0]/3,self.size[1]-1)
            D3Button:
                text: "Reference\nImage"
                font_size: 16
                size_hint: 1.0, 1.0
                on_press:
                    root.button_press(self.text)
                    root.manager.transition.direction = 'left'
            CheckBox:
                id: ref_taken_radio_button
                active: False
                color: 0,1,0,1
                size_hint: 0.5, 1.0
                group:"1"

        Histogram:
            id: hist
            size_hint: .2, .25
            pos_hint: {'right':1, 'y':.5}

        D3Button:
            size_hint: .2, .2
            text: 'Capture'
            on_press:
                root.button_press(self.text)
                root.manager.transition.direction = 'left'
        StackLayout:
            orientation: 'tb-rl'
            size_hint: .2,.2
            
            canvas.before:
                Color:
                    rgba: 1, 1, 1, .1
                Rectangle:
                    pos: self.pos
                    size: self.size
            BoxLayout:
                orientation: 'horizontal'
                size_hint: 1.0,.3
                Label:
                    size_hint: 1.0,1.0
                    text: "K"
                    font_size: 24
                Label:
                    size_hint: 1.0,1.0
                    text: "L"
                    font_size: 24
                Label:
                    size_hint: 1.0,1.0
                    text: "Ki67"
                    font_size: 24

            BoxLayout:
                orientation: 'horizontal'
                size_hint: 1.0,.7

                CheckBox:
                    id: kappa_radio_button
                    active: True
                    color: 1,0,0,2
                    size_hint: 1.0, 1.0
                    group:"1"

                CheckBox:
                    id: lambda_radio_button
                    active: True
                    color: 1,0,0,2
                    size_hint: 1.0, 1.0
                    group:"2"

                CheckBox:
                    id: ki67_radio_button
                    active: True
                    color: 1,0,0,2
                    size_hint: 1.0, 1.0
                    group:"3"

    Camera_Canvas:
        size_hint: 1.0,0.885
        pos_hint: {'x':-0.1, 'y':0.005}
        id: camera
        resolution: (640, 480)
        play: True

    D3Button:
        text: "Exit"
        font_size: 24
        size_hint: .1, .1
        pos_hint: {'right':1, 'top':1}
        on_press:
            root.button_press(self.text)

    StackLayout:
        orientation: 'lr-tb'
        pos_hint:{"x":0.04}
        spacing:[5,0]

        D3Button:
            text: "Cell Detection on/off"
            size_hint: 0.25,0.1
            font_size: 20
        D3Button:
            text: "Cell Count"
            size_hint: 0.15,0.1
            font_size: 20


    StackLayout:
        orientation: 'rl-tb'
        pos_hint:{"x":-0.1}
        spacing:[5,0]
        D3Button:
            text: "Next Marker"
            size_hint: 0.17,0.1
            font_size: 20
        D3Button:
            text: "Retake"
            size_hint: 0.12,0.1
            font_size: 20



<Continue_Screen@Display_Object>:
    D3Button:
        size_hint: .45, .3
        pos_hint: {'x':0.025, 'y':.4}
        text: "Continue With Same\nPatient"
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'
    D3Button:
        size_hint: .45, .3
        pos_hint: {'x':0.525, 'y':.4}
        text: "Continue With Different\nPatient"
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'