#:kivy 1.0.9
#:import kivy kivy
#:import win kivy.core.window
#:import Histogram Util.Camera_Histogram
#:import Camera_Canvas Util.D3_Camera_Image_Canvas

<D3Button@Button>:
    size_hint: .3, .2
    color: 0, 0, 0, 1
    font_size: 32
    bold: True
    background_color: 2,2,2, 2
    halign: "center"

<Display_Object@Screen>:
    FloatLayout:
        background_color: 0, 0.5, 0.5, 1

<D3TextInput@TextInput>:
    size_hint: .2, None
    height: 35
    color: 0, 0, 0, 1
    font_size: 20
    background_color: 1, 1, 1, 1

<D3Label@Label>:
    size_hint: .2, None
    height: 45
    color: 1, 1, 1, 1
    font_size: 20
    background_color: 1, 1, 1, 1
    text_size: self.size
    halign: 'left'
    valign: 'middle'

<D3Image@Image>:
    allow_stretch:True
    size: 400, 400

<Login_Screen>:
    Label:
        font_size: 140
        bold: True
        text: "MGH D3"
        pos_hint: {'center_x':0.5,'y':0.27}

    D3TextInput:
        id: username
        pos_hint: {'x':0.29, 'y':0.39}
        hint_text: "User ID"
        multiline: False

    D3TextInput:
        id: password
        pos_hint: {'x':0.29, 'y':0.302}
        hint_text: "Password"
        password: True
        multiline: False

    D3Button:
        text: "LOGIN"
        pos_hint: {'x': 0.5, 'y':0.3}
        size_hint: 0.15, 0.15
        font_size: 24
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'
    D3Button:
        text: "EXIT"
        size_hint: .13,.07
        pos_hint:{"left":1,"top":1}
        font_size: 24
        on_press:
            root.button_press(self.text)

<Change_Patient_Screen>:
    Label:
        font_size: 140
        bold: True
        text: "MGH D3"
        pos_hint: {'center_x':0.5,'y':0.27}

    D3Button:
        text: "New Patient"
        pos_hint: {'x': 0.15, 'y':0.27}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'right'

    D3Button:
        text: "Browse Patients"
        pos_hint: {'x':0.55, 'y':0.27}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'
    D3Button:
        text: "Logout"
        font_size: 20
        size_hint: .13,.07
        pos_hint: {'left':1, 'top':1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'right'


<Create_New_Patient_Screen>:

    D3Button:
        text: "Cancel"
        pos_hint: {'x': 0.1, 'y':0.1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'

    D3Button:
        text: "Save Patient"
        pos_hint: {'x':0.6, 'y':0.1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'

    D3Label:
        text: "Patient Name"
        pos_hint: {'x':0.1, 'y':0.8}

    D3TextInput:
        id: patient_name
        pos_hint: {'x':0.4, 'y':0.8}
        text: ""
        multiline: False

    D3Label:
        text: "Comments"
        pos_hint: {'x':0.1, 'y':0.6}

    D3TextInput:
        id: patient_comments
        pos_hint: {'x':0.4, 'y':0.6}
        text:""
        height:80
    D3Button:
        text: "Home"
        font_size: 20
        size_hint: .13,.07
        pos_hint: {'left':1, 'top':1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'

<Browse_Images_Screen>:
    FileChooserListView:
        id: filechooser

    D3Button:
        text: "Cancel"
        pos_hint: {'x': 0.1, 'y':0.1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'right'

    D3Button:
        text: "Select"
        pos_hint: {'x': 0.6, 'y':0.1}
        on_press:
            root.button_press(self.text, data=filechooser.selection)
            root.manager.transition.direction = 'left'
    D3Button:
        text: "Home"
        font_size: 20
        size_hint: .13,.07
        pos_hint: {'left':1, 'top':1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'

<Browse_Patients_Screen>:
    FileChooserListView:
        id: filechooser
        path: "data/patients/"

    D3Button:
        text: "Cancel"
        pos_hint: {'x': 0.1, 'y':0.1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'right'

    D3Button:
        text: "Select"
        pos_hint: {'x': 0.6, 'y':0.1}
        on_press:
            root.button_press(self.text, data=filechooser.selection)
            root.manager.transition.direction = 'left'

    D3Button:
        text: "Home"
        size_hint: .13,.07
        font_size: 20
        pos_hint: {'left':1, 'top':1}
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'

<Sample_View_Screen>:
    StackLayout:
        orientation:"rl-bt"

        D3Button:
            size_hint: .2, .1
            pos_hint:{"right":1,"bottom":1}
            text: "Save"
            font_size: 20
            on_press:
                root.button_press(self.text)
                root.manager.transition.direction = 'left'

        D3Button:
            text: "Retry"
            size_hint: 0.2,0.1
            font_size: 20
            on_press:
                root.button_press(self.text)
                root.manager.transition.direction = 'right'

    D3Button:
        text: "Home"
        font_size: 20
        size_hint: .1, .1
        pos_hint: {'right':1, 'top':1}
        on_press:
            root.button_press(self.text)

    StackLayout:
        orientation: 'lr-tb'
        spacing:[5,0]

        D3Button:
            text: "Cell Detection on/off"
            size_hint: 0.25,0.1
            font_size: 20
            on_press:
                root.button_press(self.text)
    D3Image:
        size_hint: 0.9,0.9
        pos_hint: {"center_x":0.5,"center_y":0.5}
        id: sample_image
        source:

<Idle_Screen>:
    StackLayout:
        orientation: 'tb-rl'
        pos_hint:{"x":-0.005,"y":-0.107}
        spacing: [0,5]
        D3Button:
            size_hint: .2, .15
            font_size: 20
            text: "Toggle\nLED"
            on_press:
                root.button_press(self.text)
                root.manager.transition.direction = 'left'
        BoxLayout:
            orientation: 'horizontal'
            size_hint: .2,.1
            canvas.before:
                Color:
                    rgba: 1, 1, 1, .1
                Rectangle:
                    pos: (self.pos[0] + self.width - self.size[0]/3 - 2,self.pos[1]+1)
                    size: (self.size[0]/3,self.size[1]-1)
            D3Button:
                text: "Reference\nImage"
                font_size: 19
                size_hint: 1.0, 1.0
                on_press:
                    root.button_press(self.text)
                    root.manager.transition.direction = 'left'
            CheckBox:
                id: ref_taken_radio_button
                active: False
                color: 0,1,0,1
                size_hint: 0.5, 1.0
                group:"1"
        Histogram:
            id: sample_histogram
            size_hint: .2, .25
            pos_hint: {'right':1, 'y':.5}

        D3Button:
            size_hint: .2, .2
            text: 'Capture'
            font_size: 20
            on_press:
                root.button_press(self.text)
                root.manager.transition.direction = 'left'
        StackLayout:
            orientation: 'tb-rl'
            size_hint: .2,.2

            canvas.before:
                Color:
                    rgba: 1, 1, 1, .1
                Rectangle:
                    pos: self.pos
                    size: self.size
            BoxLayout:
                orientation: 'horizontal'
                size_hint: 1.0,.3
                Label:
                    size_hint: 1.0,1.0
                    text: "K"
                    font_size: 24
                Label:
                    size_hint: 1.0,1.0
                    text: "L"
                    font_size: 24
                Label:
                    size_hint: 1.0,1.0
                    text: "Ki67"
                    font_size: 24

            BoxLayout:
                orientation: 'horizontal'
                size_hint: 1.0,.7

                CheckBox:
                    id: kappa_radio_button
                    active: True
                    color: 3,1,0,2
                    size_hint: 1.0, 1.0
                    group:"1"

                CheckBox:
                    id: lambda_radio_button
                    active: False
                    color: 1,1,1,2
                    size_hint: 1.0, 1.0
                    group:"2"

                CheckBox:
                    id: ki67_radio_button
                    active: False
                    color: 1,1,1,2
                    size_hint: 1.0, 1.0
                    group:"3"
    Camera_Canvas:
        size_hint: 1.0,0.885
        pos_hint: {'x':-0.1, 'y':0.005}
        id: camera
        resolution: (640, 480)
        play: True

    D3Button:
        text: "Home"
        font_size: 20
        size_hint: .1, .1
        pos_hint: {'left':1, 'top':1}
        on_press:
            root.button_press(self.text)

    StackLayout:
        orientation: 'rl-tb'
        spacing:[5,0]
        pos_hint:{"x":-0.005}
        D3Button:
            id: next_marker_button
            text: "Next Marker"
            size_hint: 0.2,0.1
            font_size: 20
            on_press:
                root.button_press(self.text)
        D3Button:
            id: prev_marker_button
            text: "Previous Marker"
            size_hint: 0.2,0.1
            font_size: 20
            on_press:
                root.button_press(self.text)

<Continue_Screen>:
    D3Button:
        size_hint: .45, .3
        pos_hint: {'x':0.025, 'y':.4}
        text: "Continue With Same\nPatient"
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'
    D3Button:
        size_hint: .45, .3
        pos_hint: {'x':0.525, 'y':.4}
        text: "Continue With Different\nPatient"
        on_press:
            root.button_press(self.text)
            root.manager.transition.direction = 'left'